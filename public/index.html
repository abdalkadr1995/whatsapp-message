<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Message Sender</title>

    <!-- Ø¥Ø¶Ø§ÙØ© Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Ø¥Ø¶Ø§ÙØ© Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Ø¥Ø¶Ø§ÙØ© SweetAlert2 -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.min.css" rel="stylesheet" />
</head>
<style>
    .inner-container {
        background-color: #eff3f8;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 2px;
    }

    .card {

        width: 500px;
    }
</style>

<body class="bg-light">
    <div class="container py-3">
        <!-- Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§ØªØµØ§Ù„ -->
        <div class="row">
            <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ -->
            <div class="col-md-6">
                <div class="card shadow-lg">
                    <div class="card-header bg-primary text-white text-center">
                        <h2>Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø¯Ø±Ø¯Ø´Ø© ÙˆØ§ØªØ³Ø§Ø¨</h2>
                    </div>
                    <div class="card-body">
                        <div class="inner-container" id="receivedFormContainer">
                            <h4 class="text-center mb-4">Ù†Ù…ÙˆØ°Ø¬ Ø§Ø³ØªÙ„Ù…Ù†Ø§</h4>
                            <form id="formReceived" onsubmit="sendMessage(event, 'Ø§Ø³ØªÙ„Ù…Ù†Ø§')">
                                <div class="row">
                                    <div class="col-md-12 mb-4">
                                        <label for="chatSelectReceived" class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:</label>
                                        <select id="chatSelectReceived" name="chat" class="form-select" required>
                                            <option value="" disabled selected>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª...</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <label for="usdAmountReceived" class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±:</label>
                                        <input type="number" id="usdAmountReceived" class="form-control"
                                            placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±">
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <label for="tryAmountReceived" class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„ØªØ±ÙƒÙŠ:</label>
                                        <input type="number" id="tryAmountReceived" class="form-control"
                                            placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„ØªØ±ÙƒÙŠ">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mb-4">
                                        <label for="noteForUs" class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø©:</label>
                                        <input type="text" id="noteForUs" class="form-control"
                                            placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø©">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mb-4 d-flex align-items-center justify-content-center">
                                        <button type="submit" class="btn btn-success w-100">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø«Ø§Ù†ÙŠ -->
            <div class="col-md-6">
                <div class="card shadow-lg">
                    <div class="card-header bg-primary text-white text-center">
                        <h2>Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø¯Ø±Ø¯Ø´Ø© ÙˆØ§ØªØ³Ø§Ø¨</h2>
                    </div>
                    <div class="card-body">
                        <div class="inner-container" id="forUsFormContainer">
                            <h4 class="text-center mb-4">Ù†Ù…ÙˆØ°Ø¬ Ù„Ù†Ø§</h4>
                            <form id="formForUs" onsubmit="sendMessage(event, 'Ù„Ù†Ø§')">
                                <div class="row">
                                    <div class="col-md-12 mb-4">
                                        <label for="chatSelectForUs" class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:</label>
                                        <select id="chatSelectForUs" name="chat" class="form-select" required>
                                            <option value="" disabled selected>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª...</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <label for="usdAmountForUs" class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±:</label>
                                        <input type="number" id="usdAmountForUs" class="form-control"
                                            placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±">
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <label for="tryAmountForUs" class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„ØªØ±ÙƒÙŠ:</label>
                                        <input type="number" id="tryAmountForUs" class="form-control"
                                            placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„ØªØ±ÙƒÙŠ">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mb-4">
                                        <label for="note" class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø©:</label>
                                        <input type="text" id="note" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø©">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mb-4 d-flex align-items-center justify-content-center">
                                        <button type="submit" class="btn btn-success w-100">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø§Øª JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Ù…ÙƒØªØ¨Ø© Select2
        $(document).ready(function () {
            $('#chatSelectReceived, #chatSelectForUs').select2({
                placeholder: "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©",
                width: '100%'
            });
        });

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯
        async function sendMessage(event, messageType) {
            event.preventDefault();

            const chatId = messageType === 'Ø§Ø³ØªÙ„Ù…Ù†Ø§' ? $('#chatSelectReceived').val() : $('#chatSelectForUs').val();
            const usdAmount = messageType === 'Ø§Ø³ØªÙ„Ù…Ù†Ø§' ? $('#usdAmountReceived').val() : $('#usdAmountForUs').val();
            const tryAmount = messageType === 'Ø§Ø³ØªÙ„Ù…Ù†Ø§' ? $('#tryAmountReceived').val() : $('#tryAmountForUs').val();
            const note = messageType === 'Ù„Ù†Ø§' ? $('#noteForUs').val() : '';

            if (!chatId || (!usdAmount && !tryAmount)) {
                Swal.fire({
                    icon: 'warning',
                    title: 'ØªÙ†Ø¨ÙŠÙ‡',
                    text: 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº',
                });
                return;
            }

            // ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹
            let message = `âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø¨Ù„Øº:\n----------------\n`;
            if (usdAmount) message += `ğŸ’µ ${usdAmount} Ø¯ÙˆÙ„Ø§Ø±\n----------------\n`;
            if (tryAmount) message += `ğŸ’´ ${tryAmount} Ù„ÙŠØ±Ø© ØªØ±ÙƒÙŠØ©\n----------------\n`;
            message += `\n(Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§.)`;


            try {
                const response = await fetch('/send-message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ chat: chatId, message })
                });

                const result = await response.json();
                if (result.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­',
                        html: `<p>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</p><pre>${message}</pre>`,
                        confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§'
                    });
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                    $(`#form${messageType === 'Ø§Ø³ØªÙ„Ù…Ù†Ø§' ? 'Received' : 'ForUs'}`)[0].reset();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„',
                        text: `ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${result.error}`,
                    });
                }
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Ø®Ø·Ø£',
                    text: 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©',
                });
                console.error(error);
            }
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = async function fetchChats() {
            const response = await fetch('/get-chats');
            const chats = await response.json();
            const chatSelectReceived = $('#chatSelectReceived');
            const chatSelectForUs = $('#chatSelectForUs');
            chatSelectReceived.empty();
            chatSelectForUs.empty();

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            chatSelectReceived.append('<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</option>');
            chatSelectForUs.append('<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</option>');

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            chats.forEach(chat => {
                chatSelectReceived.append(new Option(chat.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…', chat.id));
                chatSelectForUs.append(new Option(chat.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…', chat.id));
            });
        };



        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§ØªØµØ§Ù„
       

    </script>
</body>

</html>